From 1f74c3ac607647ff3180875f825f5c9e899c154c Mon Sep 17 00:00:00 2001
From: Jerome St-Louis <jerome@ecere.com>
Date: Mon, 19 Nov 2012 07:11:18 -0500
Subject: [PATCH 07/14] ecere/gui/FileDialog: Fixed conditional jump depending
 on uninitialized memory

---
 ecere/src/gui/dialogs/FileDialog.ec |    2 +-
 ecere/src/sys/File.ec               |   31 +++++++++++++++++--------------
 2 files changed, 18 insertions(+), 15 deletions(-)

diff --git a/ecere/src/gui/dialogs/FileDialog.ec b/ecere/src/gui/dialogs/FileDialog.ec
index ea7bcd8..03fb286 100644
--- a/ecere/src/gui/dialogs/FileDialog.ec
+++ b/ecere/src/gui/dialogs/FileDialog.ec
@@ -783,7 +783,7 @@ private:
    bool SelectFile(char * fileName, FileDialogSelectFrom from, bool isOK)
    {
       bool result = true;
-      FileAttribs exists;
+      FileAttribs exists = 0;
       char * wildcardPointer = strstr(fileName, "*");
       
       if(wildcardPointer)
diff --git a/ecere/src/sys/File.ec b/ecere/src/sys/File.ec
index 149a356..aaaa758 100644
--- a/ecere/src/sys/File.ec
+++ b/ecere/src/sys/File.ec
@@ -1382,13 +1382,14 @@ static FileDesc FileFind(char * path, char * extensions)
                }
                strcpy(file.name,de->d_name);
                strcat(file.path, file.name);
-               stat(file.path, &s);
-               file.stats.attribs = (s.st_mode&S_IFDIR) ? FileAttribs { isDirectory = true } : FileAttribs { isFile = true };
-               file.stats.size = s.st_size;
-               file.stats.accessed = s.st_atime;
-               file.stats.modified = s.st_mtime;
-               file.stats.created = s.st_ctime;
-          
+               if(!stat(file.path, &s))
+               {
+                  file.stats.attribs = (s.st_mode&S_IFDIR) ? FileAttribs { isDirectory = true } : FileAttribs { isFile = true };
+                  file.stats.size = s.st_size;
+                  file.stats.accessed = s.st_atime;
+                  file.stats.modified = s.st_mtime;
+                  file.stats.created = s.st_ctime;
+               }
                strcpy(d.name, path);
 
                result = file;
@@ -1656,13 +1657,15 @@ private class FileDesc : struct
                if(d.name[0] && d.name[1])
                   strcat(path, DIR_SEPS);
                strcat(path, name);
-               stat(path, &s);
-               stats.attribs = FileAttribs { };
-               stats.attribs = (s.st_mode&S_IFDIR) ? FileAttribs { isDirectory = true } : FileAttribs { isFile = true };
-               stats.size = s.st_size;
-               stats.accessed = s.st_atime;
-               stats.modified = s.st_mtime;
-               stats.created = s.st_ctime;
+               if(!stat(path, &s))
+               {
+                  stats.attribs = FileAttribs { };
+                  stats.attribs = (s.st_mode&S_IFDIR) ? FileAttribs { isDirectory = true } : FileAttribs { isFile = true };
+                  stats.size = s.st_size;
+                  stats.accessed = s.st_atime;
+                  stats.modified = s.st_mtime;
+                  stats.created = s.st_ctime;
+               }
                result = this;
             }
             else
-- 
1.7.9.5

